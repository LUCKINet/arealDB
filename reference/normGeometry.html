<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Normalise geometries — normGeometry • arealDB</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Normalise geometries — normGeometry"><meta property="og:description" content="Harmonise and integrate geometries into a standardised format"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">arealDB</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/arealDB.html">Getting Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="http://www.twitter.com/DerEhrmann" class="external-link">
    <span class="fa fa-twitter fa-lg"></span>

  </a>
</li>
<li>
  <a href="https://github.com/EhrmannS/arealDB" class="external-link">
    <span class="fa fa-github"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Normalise geometries</h1>
    <small class="dont-index">Source: <a href="https://github.com/luckinet/arealDB/blob/master/R/normGeometry.R" class="external-link"><code>R/normGeometry.R</code></a></small>
    <div class="hidden name"><code>normGeometry.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Harmonise and integrate geometries into a standardised format</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">normGeometry</span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pattern <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  query <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  thresh <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  beep <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  simplify <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  stringdist <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  strictMatch <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-input">input<a class="anchor" aria-label="anchor" href="#arg-input"></a></dt>
<dd><p><code><a href="https://rdrr.io/r/base/character.html" class="external-link">character(1)</a></code><br> path of the file to normalise. If
this is left empty, all files at stage two as subset by <code>pattern</code> are
chosen.</p></dd>


<dt id="arg-pattern">pattern<a class="anchor" aria-label="anchor" href="#arg-pattern"></a></dt>
<dd><p><code><a href="https://rdrr.io/r/base/character.html" class="external-link">character(1)</a></code><br> an optional regular expression.
Only dataset names which match the regular expression will be processed.</p></dd>


<dt id="arg-query">query<a class="anchor" aria-label="anchor" href="#arg-query"></a></dt>
<dd><p><code><a href="https://rdrr.io/r/base/character.html" class="external-link">character(1)</a></code><br> part of the SQL query (starting
from
WHERE) used to subset the input geometries, for example <code>"where NAME_0
  = 'Estonia'"</code>. The first part of the query (where the layer is defined) is
derived from the meta-data of the currently handled geometry.</p></dd>


<dt id="arg-thresh">thresh<a class="anchor" aria-label="anchor" href="#arg-thresh"></a></dt>
<dd><p><code><a href="https://rdrr.io/r/base/integer.html" class="external-link">integerish(1)</a></code><br> percent value of overlap below
which two geometries (the input and the base) are considered to be the
same. This is required, because often the polygons from different sources,
albeit describing the same territorial unit, aren't completely the same.</p></dd>


<dt id="arg-beep">beep<a class="anchor" aria-label="anchor" href="#arg-beep"></a></dt>
<dd><p><code><a href="https://rdrr.io/r/base/integer.html" class="external-link">integerish(1)</a></code><br> Number specifying what sound to be
played to signal the user that a point of interaction is reached by the
program, see <code><a href="https://rdrr.io/pkg/beepr/man/beep.html" class="external-link">beep</a></code>.</p></dd>


<dt id="arg-simplify">simplify<a class="anchor" aria-label="anchor" href="#arg-simplify"></a></dt>
<dd><p><code><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical(1)</a></code><br> whether or not to simplify
geometries.</p></dd>


<dt id="arg-stringdist">stringdist<a class="anchor" aria-label="anchor" href="#arg-stringdist"></a></dt>
<dd><p><code><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical(1)</a></code><br> whether or not to use string
distance to find matches (should not be used for large datasets/when a
memory error is shown).</p></dd>


<dt id="arg-strictmatch">strictMatch<a class="anchor" aria-label="anchor" href="#arg-strictmatch"></a></dt>
<dd><p><code><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical(1)</a></code><br> whether or not matches are
strict, i.e., there should be clear one-to-one relationships and no changes
in broader concepts.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p><code><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical(1)</a></code><br> be verbose about what is happening
(default <code>FALSE</code>). Furthermore, you can use
<code><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></code> to make this function completely silent.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>This function harmonises and integrates so far unprocessed geometries
at stage two into stage three of the geospatial database. It produces for
each main polygon (e.g. nation) in the registered geometries a spatial file
of the specified file-type.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>To normalise geometries, this function proceeds as follows:</p><ol><li><p>Read in <code>input</code> and extract initial metadata from
the file name.</p></li>
<li><p>In case filters are set, the new geometry is filtered
by those.</p></li>
<li><p>The territorial names are matched with the gazetteer to
harmonise new territorial names (at this step, the function might ask the
user to edit the file 'matching.csv' to align new names with already
harmonised names).</p></li>
<li><p>Loop through every nation potentially included in
the file that shall be processed and carry out the following steps:</p><ul><li><p>In case the geometries are provided as a list of simple
feature POLYGONS, they are dissolved into a single MULTIPOLYGON per main
polygon.</p></li>
<li><p>In case the nation to which a geometry belongs has not yet
been created at stage three, the following steps are carried out:</p><ol><li><p>Store the current geometry as basis of the respective
level (the user needs to make sure that all following levels of the same
dataseries are perfectly nested into those parent territories, for example
by using the GADM dataset)</p></li>
</ol></li>
<li><p>In case the nation to which the geometry
belongs has already been created, the following steps are carried out:</p><ol><li><p>Check whether the new geometries have the same coordinate
reference system as the already existing database and re-project the new
geometries if this is not the case.</p></li>
<li><p>Check whether all new geometries
are already exactly matched spatially and stop if that is the case.</p></li>
<li><p>Check whether the new geometries are all within the already defined
parents, and save those that are not as a new geometry.</p></li>
<li><p>Calculate
spatial overlap and distinguish the geometries into those that overlap with
more and those with less than <code>thresh</code>.</p></li>
<li><p>For all units that dName
match, copy gazID from the geometries they overlap.</p></li>
<li><p>For all units
that dName not match, rebuild metadata and a new gazID.</p></li>
</ol></li>
<li><p>store the
processed geometry at stage three.</p></li>
</ul></li>
<li><p>Move the geometry to the folder
'/processed', if it is fully processed.</p></li>
</ol></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other normalise functions:
<code><a href="normTable.html">normTable</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.interactive.html" class="external-link">dev.interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># build the example database</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="adb_example.html">adb_example</a></span><span class="op">(</span>until <span class="op">=</span> <span class="st">"regGeometry"</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># normalise all geometries ...</span></span></span>
<span class="r-in"><span>  <span class="fu">normGeometry</span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"estonia"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># ... and check the result</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_layers.html" class="external-link">st_layers</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/geometries/stage3/Estonia.gpkg"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/geometries/stage3/Estonia.gpkg"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://orcid.org/0000-0002-2958-0796" class="external-link">Steffen Ehrmann</a>, <a href="https://orcid.org/0000-0001-8637-9071" class="external-link">Arne Rümmler</a>, <a href="https://orcid.org/0000-0003-3927-5856" class="external-link">Carsten Meyer</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

